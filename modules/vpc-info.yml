---
# Collect vpc cloudformation stack output
- name: Set variable
  set_fact:
    vpc_cfn_stack: "{{ cluster_name }}-vpc-stack" 

- name: "vpc-info - Get vpc CloudFormation stack facts"
  amazon.aws.cloudformation_info:
    stack_name: "{{ vpc_cfn_stack }}" 
  register: vpc_stack_info

- debug:
    var: vpc_stack_info

- name: "vpc-info - Set outputs as variables"
  set_fact:
    PrivateSubnet1: "{{ vpc_stack_info.cloudformation[ vpc_cfn_stack ][ 'stack_outputs' ][ 'PrivateSubnet1' ] }}"
    PrivateSubnet2: "{{ vpc_stack_info.cloudformation[ vpc_cfn_stack ][ 'stack_outputs' ][ 'PrivateSubnet2' ] }}"
    PrivateSubnet1: "{{ vpc_stack_info.cloudformation[ vpc_cfn_stack ][ 'stack_outputs' ][ 'PrivateSubnet2' ] }}"
    PrivateSubnetIds: "{{ vpc_stack_info.cloudformation[ vpc_cfn_stack ][ 'stack_outputs' ][ 'PrivateSubnetIds' ] }}"
    PublicRouteTableId: "{{ vpc_stack_info.cloudformation[ vpc_cfn_stack ][ 'stack_outputs' ][ 'PublicRouteTableId' ] }}"
    PublicSubnet1: "{{ vpc_stack_info.cloudformation[ vpc_cfn_stack ][ 'stack_outputs' ][ 'PublicSubnet1' ] }}"
    PublicSubnet2: "{{ vpc_stack_info.cloudformation[ vpc_cfn_stack ][ 'stack_outputs' ][ 'PublicSubnet2' ] }}"
    PublicSubnet3: "{{ vpc_stack_info.cloudformation[ vpc_cfn_stack ][ 'stack_outputs' ][ 'PublicSubnet3' ] }}"
    PublicSubnetIds: "{{ vpc_stack_info.cloudformation[ vpc_cfn_stack ][ 'stack_outputs' ][ 'PublicSubnetIds' ] }}"
    VpcId: "{{ vpc_stack_info.cloudformation[ vpc_cfn_stack ][ 'stack_outputs' ][ 'VpcId' ] }}"
